<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.7.3">Jekyll</generator><link href="https://qroph.github.io/feed.xml" rel="self" type="application/atom+xml" /><link href="https://qroph.github.io/" rel="alternate" type="text/html" /><updated>2019-02-12T22:40:16+02:00</updated><id>https://qroph.github.io/</id><title type="html">Mika’s Coding Bits</title><subtitle></subtitle><author><name>Mika Rantanen</name></author><entry><title type="html">Smooth Paths Using Catmull-Rom Splines</title><link href="https://qroph.github.io/2018/07/30/smooth-paths-using-catmull-rom-splines.html" rel="alternate" type="text/html" title="Smooth Paths Using Catmull-Rom Splines" /><published>2018-07-30T21:30:00+03:00</published><updated>2018-07-30T21:30:00+03:00</updated><id>https://qroph.github.io/2018/07/30/smooth-paths-using-catmull-rom-splines</id><content type="html" xml:base="https://qroph.github.io/2018/07/30/smooth-paths-using-catmull-rom-splines.html">&lt;p&gt;Let’s assume that we have a set of points and we want to draw a path that goes through them. The simplest and easiest way to do this is to connect the points with straight lines as shown in Figure 1.&lt;/p&gt;

&lt;figure class=&quot;svg-figure&quot;&gt;
  
&lt;svg height=&quot;130&quot; width=&quot;452&quot;&gt;&lt;polyline points=&quot;84.00,116.00 81.93,114.57 76.30,110.70 68.02,104.98 57.95,98.05 47.00,90.50 36.05,82.95 25.98,76.02 17.70,70.30 12.07,66.43 10.00,65.00&quot; class=&quot;svg-text&quot; style=&quot;fill:none;stroke-width:2&quot; /&gt;&lt;polyline points=&quot;10.00,65.00 12.52,63.46 19.36,59.28 29.44,53.12 41.68,45.64 55.00,37.50 68.32,29.36 80.56,21.88 90.64,15.72 97.48,11.54 100.00,10.00&quot; class=&quot;svg-text&quot; style=&quot;fill:none;stroke-width:2&quot; /&gt;&lt;polyline points=&quot;100.00,10.00 102.35,12.56 108.80,19.59 118.44,30.08 130.35,43.06 143.63,57.52 157.37,72.48 170.65,86.94 182.56,99.92 192.20,110.41 198.65,117.44 201.00,120.00&quot; class=&quot;svg-text&quot; style=&quot;fill:none;stroke-width:2&quot; /&gt;&lt;polyline points=&quot;201.00,120.00 203.04,119.30 208.77,117.33 217.64,114.28 229.07,110.35 242.48,105.74 257.32,100.64 273.01,95.25 288.99,89.75 304.68,84.36 319.52,79.26 332.93,74.65 344.36,70.72 353.23,67.67 358.96,65.70 361.00,65.00&quot; class=&quot;svg-text&quot; style=&quot;fill:none;stroke-width:2&quot; /&gt;&lt;polyline points=&quot;361.00,65.00 361.81,65.48 364.10,66.84 367.68,68.96 372.34,71.72 377.90,75.01 384.15,78.72 390.89,82.71 397.93,86.88 405.07,91.12 412.11,95.29 418.85,99.28 425.10,102.99 430.66,106.28 435.32,109.04 438.90,111.16 441.19,112.52 442.00,113.00&quot; class=&quot;svg-text&quot; style=&quot;fill:none;stroke-width:2&quot; /&gt;&lt;circle class=&quot;svg-brand&quot; style=&quot;stroke:none&quot; cx=&quot;84.00&quot; cy=&quot;116.00&quot; r=&quot;5&quot; /&gt;&lt;circle class=&quot;svg-brand&quot; style=&quot;stroke:none&quot; cx=&quot;10.00&quot; cy=&quot;65.00&quot; r=&quot;5&quot; /&gt;&lt;circle class=&quot;svg-brand&quot; style=&quot;stroke:none&quot; cx=&quot;100.00&quot; cy=&quot;10.00&quot; r=&quot;5&quot; /&gt;&lt;circle class=&quot;svg-brand&quot; style=&quot;stroke:none&quot; cx=&quot;201.00&quot; cy=&quot;120.00&quot; r=&quot;5&quot; /&gt;&lt;circle class=&quot;svg-brand&quot; style=&quot;stroke:none&quot; cx=&quot;361.00&quot; cy=&quot;65.00&quot; r=&quot;5&quot; /&gt;&lt;circle class=&quot;svg-brand&quot; style=&quot;stroke:none&quot; cx=&quot;442.00&quot; cy=&quot;113.00&quot; r=&quot;5&quot; /&gt;&lt;/svg&gt;

  
  &lt;figcaption&gt;A path using straight lines.&lt;/figcaption&gt;
  
&lt;/figure&gt;

&lt;p&gt;However, straight lines would cause sharp corners to the path and in many cases a smoother path would be preferred. Figure 2 shows a smoother path that goes through the same points that are in Figure 1.&lt;/p&gt;

&lt;figure class=&quot;svg-figure&quot;&gt;
  
&lt;svg height=&quot;130&quot; width=&quot;452&quot;&gt;&lt;polyline points=&quot;84.00,116.00 75.92,110.90 66.79,105.80 57.05,100.69 47.16,95.59 37.58,90.49 28.74,85.38 21.12,80.28 15.15,75.19 11.29,70.09 10.00,65.00&quot; class=&quot;svg-text&quot; style=&quot;fill:none;stroke-width:2&quot; /&gt;&lt;polyline points=&quot;10.00,65.00 11.85,58.88 16.75,51.83 24.14,44.24 33.48,36.52 44.23,29.07 55.84,22.29 67.77,16.59 79.47,12.38 90.39,10.05 100.00,10.00&quot; class=&quot;svg-text&quot; style=&quot;fill:none;stroke-width:2&quot; /&gt;&lt;polyline points=&quot;100.00,10.00 109.25,13.43 118.12,20.52 126.73,30.49 135.20,42.55 143.66,55.93 152.23,69.85 161.03,83.51 170.19,96.14 179.82,106.95 190.05,115.17 201.00,120.00&quot; class=&quot;svg-text&quot; style=&quot;fill:none;stroke-width:2&quot; /&gt;&lt;polyline points=&quot;201.00,120.00 210.22,121.20 220.08,120.50 230.48,118.17 241.32,114.49 252.50,109.75 263.93,104.21 275.49,98.17 287.10,91.90 298.64,85.67 310.02,79.78 321.15,74.49 331.90,70.09 342.20,66.85 351.93,65.07 361.00,65.00&quot; class=&quot;svg-text&quot; style=&quot;fill:none;stroke-width:2&quot; /&gt;&lt;polyline points=&quot;361.00,65.00 366.62,65.84 372.03,67.16 377.26,68.92 382.31,71.06 387.23,73.54 392.01,76.32 396.69,79.34 401.28,82.57 405.80,85.95 410.28,89.44 414.73,92.99 419.18,96.56 423.64,100.10 428.13,103.55 432.67,106.89 437.29,110.05 442.00,113.00&quot; class=&quot;svg-text&quot; style=&quot;fill:none;stroke-width:2&quot; /&gt;&lt;circle class=&quot;svg-brand&quot; style=&quot;stroke:none&quot; cx=&quot;84.00&quot; cy=&quot;116.00&quot; r=&quot;5&quot; /&gt;&lt;circle class=&quot;svg-brand&quot; style=&quot;stroke:none&quot; cx=&quot;10.00&quot; cy=&quot;65.00&quot; r=&quot;5&quot; /&gt;&lt;circle class=&quot;svg-brand&quot; style=&quot;stroke:none&quot; cx=&quot;100.00&quot; cy=&quot;10.00&quot; r=&quot;5&quot; /&gt;&lt;circle class=&quot;svg-brand&quot; style=&quot;stroke:none&quot; cx=&quot;201.00&quot; cy=&quot;120.00&quot; r=&quot;5&quot; /&gt;&lt;circle class=&quot;svg-brand&quot; style=&quot;stroke:none&quot; cx=&quot;361.00&quot; cy=&quot;65.00&quot; r=&quot;5&quot; /&gt;&lt;circle class=&quot;svg-brand&quot; style=&quot;stroke:none&quot; cx=&quot;442.00&quot; cy=&quot;113.00&quot; r=&quot;5&quot; /&gt;&lt;/svg&gt;

  
  &lt;figcaption&gt;A smooth path.&lt;/figcaption&gt;
  
&lt;/figure&gt;

&lt;p&gt;In this post I’m going to focus on Catmull-Rom splines which are commonly used in computer graphics to create smooth curves. For example, the path in Figure 2 uses them.&lt;/p&gt;

&lt;h2 id=&quot;catmull-rom-splines&quot;&gt;Catmull-Rom splines&lt;/h2&gt;

&lt;p&gt;Catmull-Rom splines are piecewise-defined polynomial functions. A single spline segment is defined by four control points &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{p}_0, \dots, \boldsymbol{p}_3&lt;/script&gt; but the actual curve is drawn only between points &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{p}_1&lt;/script&gt; and &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{p}_2&lt;/script&gt; as is illustrated in Figure 3. However, it is easy to chain these segments together.&lt;/p&gt;

&lt;figure class=&quot;svg-figure&quot;&gt;
  
&lt;svg height=&quot;91&quot; width=&quot;273&quot;&gt;&lt;polyline points=&quot;10.00,30.00 18.30,35.60 26.60,41.99 34.90,48.82 43.20,55.76 51.50,62.48 59.80,68.64 68.10,73.91 76.40,77.95 84.70,80.42 93.00,81.00&quot; class=&quot;svg-grey&quot; style=&quot;fill:none;stroke-width:2&quot; stroke-dasharray=&quot;8,8&quot; /&gt;&lt;polyline points=&quot;93.00,81.00 102.02,78.59 111.08,72.96 120.15,64.93 129.23,55.32 138.30,44.93 147.34,34.59 156.35,25.11 165.30,17.31 174.19,12.00 183.00,10.00&quot; class=&quot;svg-text&quot; style=&quot;fill:none;stroke-width:2&quot; /&gt;&lt;polyline points=&quot;183.00,10.00 189.81,10.76 196.57,13.03 203.29,16.58 209.98,21.20 216.63,26.67 223.26,32.79 229.88,39.34 236.49,46.10 243.10,52.86 249.71,59.41 256.35,65.52 263.00,71.00&quot; class=&quot;svg-grey&quot; style=&quot;fill:none;stroke-width:2&quot; stroke-dasharray=&quot;8,8&quot; /&gt;&lt;circle class=&quot;svg-brand&quot; style=&quot;stroke:none&quot; cx=&quot;10.00&quot; cy=&quot;30.00&quot; r=&quot;5&quot; /&gt;&lt;circle class=&quot;svg-brand&quot; style=&quot;stroke:none&quot; cx=&quot;93.00&quot; cy=&quot;81.00&quot; r=&quot;5&quot; /&gt;&lt;circle class=&quot;svg-brand&quot; style=&quot;stroke:none&quot; cx=&quot;183.00&quot; cy=&quot;10.00&quot; r=&quot;5&quot; /&gt;&lt;circle class=&quot;svg-brand&quot; style=&quot;stroke:none&quot; cx=&quot;263.00&quot; cy=&quot;71.00&quot; r=&quot;5&quot; /&gt;&lt;/svg&gt;

  
  &lt;figcaption&gt;One segment of Catmull-Rom spline.&lt;/figcaption&gt;
  
&lt;/figure&gt;

&lt;p&gt;If we want to draw a curve that goes through &lt;script type=&quot;math/tex&quot;&gt;k&lt;/script&gt; points, we need &lt;script type=&quot;math/tex&quot;&gt;k+2&lt;/script&gt; control points because the curve is not drawn through the first and the last ones. These two additional points can be selected arbitrarily, but they affect the shape of the curve. Now a segment between points &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{p}_n&lt;/script&gt; and &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{p}_{n+1}&lt;/script&gt; is calculated using points &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{p}_{n-1}&lt;/script&gt;, &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{p}_n&lt;/script&gt;, &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{p}_{n+1}&lt;/script&gt;, and &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{p}_{n+2}&lt;/script&gt;, where &lt;script type=&quot;math/tex&quot;&gt;1 \leq n \leq k - 1&lt;/script&gt;. When these segments are combined together, they form a continuous curve, which passes through all points between &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{p}_1&lt;/script&gt; and &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{p}_{k}&lt;/script&gt;. Figure 2 shows an example of this kind of curve.&lt;/p&gt;

&lt;p&gt;There are some parameters that can be used to control the shape of the spline. Catmull-Rom splines have three common variants: uniform, centripetal, and chordal. Differences have been studied for example &lt;a href=&quot;http://www.cemyuksel.com/research/catmullrom_param/&quot;&gt;here&lt;/a&gt;. Additionally, it is possible to use a tension parameter that defines how “tight” the spline is. When tension is 0, the result looks like the curve in Figure 2, and when tension is 1, the result is straight lines as in Figure 1. The following interactive example demonstrates Catmull-Rom splines and these parameters.&lt;/p&gt;

&lt;div class=&quot;javascript-container&quot; id=&quot;catmullrom&quot;&gt;
  &lt;div class=&quot;dat-gui-container&quot; id=&quot;catmullrom-gui&quot;&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;script&gt;
  var catmullrom_app;
  var catmullrom_gui;

  function catmullrom_initialize() {
    const container = document.getElementById('catmullrom');
    const gui_container = document.getElementById('catmullrom-gui');
    const width = container.clientWidth;
    const height = Math.max(0.6 * width, minHeight);

    const app = new PIXI.Application(width, height, { antialias: true, transparent: true });
    const gui = new dat.GUI({ autoPlace: false });
    container.appendChild(app.view);
    gui_container.appendChild(gui.domElement);

    catmullrom_app = app;
    catmullrom_gui = gui;

    window.addEventListener('resize', catmullrom_resize);
    catmullrom_resize();
  }

  function catmullrom_resize() {
    const container = document.getElementById('catmullrom');
    const width = container.clientWidth;
    const height = Math.max(0.6 * width, minHeight);

    catmullrom_app.renderer.resize(width, height);
  }
&lt;/script&gt;

&lt;p&gt;You can add points by clicking the canvas and move existing points by dragging them. The control panel allows you to change the tension of the curve and select the spline variant that is drawn.&lt;/p&gt;

&lt;h2 id=&quot;calculating-spline-segments&quot;&gt;Calculating spline segments&lt;/h2&gt;

&lt;p&gt;Let’s start with following equations that are described in a &lt;a href=&quot;https://en.wikipedia.org/wiki/Centripetal_Catmull%E2%80%93Rom_spline&quot;&gt;Wikipedia article&lt;/a&gt; about centripetal Catmull-Rom splines:&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;\boldsymbol{q}(t) = \frac{t_2 - t}{t_2 - t_1}\boldsymbol{B}_1 + \frac{t - t_1}{t_2 - t_1}\boldsymbol{B}_2,&lt;/script&gt;

&lt;p&gt;where&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;% &lt;![CDATA[
\begin{align}
\boldsymbol{B}_1 &amp;= \frac{t_2 - t}{t_2 - t_0}\boldsymbol{A}_1 + \frac{t - t_0}{t_2 - t_0}\boldsymbol{A}_2, \\
\boldsymbol{B}_2 &amp;= \frac{t_3 - t}{t_3 - t_1}\boldsymbol{A}_2 + \frac{t - t_1}{t_3 - t_1}\boldsymbol{A}_3, \\
\boldsymbol{A}_1 &amp;= \frac{t_1 - t}{t_1 - t_0}\boldsymbol{p}_0 + \frac{t - t_0}{t_1 - t_0}\boldsymbol{p}_1, \\
\boldsymbol{A}_2 &amp;= \frac{t_2 - t}{t_2 - t_1}\boldsymbol{p}_1 + \frac{t - t_1}{t_2 - t_1}\boldsymbol{p}_2, \\
\boldsymbol{A}_3 &amp;= \frac{t_3 - t}{t_3 - t_2}\boldsymbol{p}_2 + \frac{t - t_2}{t_3 - t_2}\boldsymbol{p}_3,
\end{align} %]]&gt;&lt;/script&gt;

&lt;p&gt;and where&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;t_i = t_{i-1} + \|\boldsymbol{p}_i - \boldsymbol{p}_{i-1}\|^\alpha,&lt;/script&gt;

&lt;p&gt;and &lt;script type=&quot;math/tex&quot;&gt;t_0 = 0&lt;/script&gt;, &lt;script type=&quot;math/tex&quot;&gt;i = 1, 2, 3&lt;/script&gt;, and &lt;script type=&quot;math/tex&quot;&gt;\alpha \in [0, 1]&lt;/script&gt;.&lt;/p&gt;

&lt;p&gt;The actual segment we are interested in is between &lt;script type=&quot;math/tex&quot;&gt;t_1&lt;/script&gt; and &lt;script type=&quot;math/tex&quot;&gt;t_2&lt;/script&gt; i.e. &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{q}(t_1) = \boldsymbol{p}_1&lt;/script&gt; and &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{q}(t_2) = \boldsymbol{p}_2&lt;/script&gt;. If &lt;script type=&quot;math/tex&quot;&gt;\alpha = 0&lt;/script&gt;, the resulting curve &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{q}&lt;/script&gt; is a uniform Catmull-Rom spline. When &lt;script type=&quot;math/tex&quot;&gt;\alpha = 0.5&lt;/script&gt;, the curve is a centripetal variant and when &lt;script type=&quot;math/tex&quot;&gt;\alpha = 1&lt;/script&gt;, the result is a chordal variant.&lt;/p&gt;

&lt;p&gt;Calculating the curve with previous equation can be quite inconvenient. Often it would be better to use precalculated constants &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{a}&lt;/script&gt;, &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{b}&lt;/script&gt;, &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{c}&lt;/script&gt;, and &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{d}&lt;/script&gt;, and represent the curve segment between &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{p}_1&lt;/script&gt; and &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{p}_2&lt;/script&gt; as&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;\boldsymbol{p}(t) = \boldsymbol{a}t^3 + \boldsymbol{b}t^2 + \boldsymbol{c}t + \boldsymbol{d},&lt;/script&gt;

&lt;p&gt;where &lt;script type=&quot;math/tex&quot;&gt;t \in [0, 1]&lt;/script&gt;, &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{p}(0) = \boldsymbol{p}_1&lt;/script&gt;, and &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{p}(1) = \boldsymbol{p}_2&lt;/script&gt;. Other way to define this is&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;\boldsymbol{p}(t) = \boldsymbol{q}(t_1 + t(t_2 - t_1)).&lt;/script&gt;

&lt;p&gt;We can get a relationship between the tangents of &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{p}&lt;/script&gt; and &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{q}&lt;/script&gt; by differentiating these with respect to &lt;script type=&quot;math/tex&quot;&gt;t&lt;/script&gt; as follows:&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;\boldsymbol{p}'(t) = 3\boldsymbol{a}t^2 + 2\boldsymbol{b}t + \boldsymbol{c} = (t_2 - t_1)\boldsymbol{q}'(t_1 + t(t_2 - t_1)).&lt;/script&gt;

&lt;p&gt;Now we have&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;% &lt;![CDATA[
\begin{align}
\boldsymbol{p}(0) &amp;= \boldsymbol{q}(t_1) &amp;&amp;= \boldsymbol{p}_1 = \boldsymbol{d}, \\
\boldsymbol{p}(1) &amp;= \boldsymbol{q}(t_2) &amp;&amp;= \boldsymbol{p}_2 = \boldsymbol{a} + \boldsymbol{b} + \boldsymbol{c} + \boldsymbol{d}, \\
\boldsymbol{p}'(0) &amp;= (t_2 - t_1)\boldsymbol{q}'(t_1) &amp;&amp;= \boldsymbol{m}_1 = \boldsymbol{c}, \\
\boldsymbol{p}'(1) &amp;= (t_2 - t_1)\boldsymbol{q}'(t_2) &amp;&amp;= \boldsymbol{m}_2 = 3\boldsymbol{a} + 2\boldsymbol{b} + c,
\end{align} %]]&gt;&lt;/script&gt;

&lt;p&gt;where symbols &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{m}_1&lt;/script&gt;, and &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{m}_2&lt;/script&gt; are used to represent tangents at the starting point &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{p}_1&lt;/script&gt; and at the ending point &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{p}_2&lt;/script&gt; respectively. By solving &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{a}&lt;/script&gt;, &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{b}&lt;/script&gt;, &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{c}&lt;/script&gt;, and &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{d}&lt;/script&gt; from these four equations we get&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;% &lt;![CDATA[
\begin{align}
\boldsymbol{a} &amp;= 2\boldsymbol{p}_1 - 2\boldsymbol{p}_2 + \boldsymbol{m}_1 + \boldsymbol{m}_2, \\
\boldsymbol{b} &amp;= -3\boldsymbol{p}_1 + 3\boldsymbol{p}_2 - 2\boldsymbol{m}_1 - \boldsymbol{m}_2, \\
\boldsymbol{c} &amp;= \boldsymbol{m}_1, \\
\boldsymbol{d} &amp;= \boldsymbol{p}_1.
\end{align} %]]&gt;&lt;/script&gt;

&lt;p&gt;Now we have to determine &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{m}_1&lt;/script&gt; and &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{m}_2&lt;/script&gt; and for that we need tangents &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{q}'(t_1)&lt;/script&gt; and &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{q}'(t_2)&lt;/script&gt;. Calculating the derivative of &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{q}&lt;/script&gt; is quite cumbersome, but luckily we can use &lt;a href=&quot;https://sandbox.open.wolframcloud.com/&quot;&gt;Mathematica&lt;/a&gt; to do the work for us. We get&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;% &lt;![CDATA[
\begin{align}
\boldsymbol{q}'(t_1) &amp;= \frac{\boldsymbol{p}_1 - \boldsymbol{p}_0}{t_1 - t_0} - \frac{\boldsymbol{p}_2 - \boldsymbol{p}_0}{t_2 - t_0} + \frac{\boldsymbol{p}_2 - \boldsymbol{p}_1}{t_2 - t_1}, \\
\boldsymbol{q}'(t_2) &amp;= \frac{\boldsymbol{p}_2 - \boldsymbol{p}_1}{t_2 - t_1} - \frac{\boldsymbol{p}_3 - \boldsymbol{p}_1}{t_3 - t_1} + \frac{\boldsymbol{p}_3 - \boldsymbol{p}_2}{t_3 - t_2},
\end{align} %]]&gt;&lt;/script&gt;

&lt;p&gt;and thus&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;\begin{align}
\boldsymbol{m}_1 = (t_2 - t_1)\left(\frac{\boldsymbol{p}_1 - \boldsymbol{p}_0}{t_1 - t_0} - \frac{\boldsymbol{p}_2 - \boldsymbol{p}_0}{t_2 - t_0} + \frac{\boldsymbol{p}_2 - \boldsymbol{p}_1}{t_2 - t_1}\right), \\
\boldsymbol{m}_2 = (t_2 - t_1)\left(\frac{\boldsymbol{p}_2 - \boldsymbol{p}_1}{t_2 - t_1} - \frac{\boldsymbol{p}_3 - \boldsymbol{p}_1}{t_3 - t_1} + \frac{\boldsymbol{p}_3 - \boldsymbol{p}_2}{t_3 - t_2}\right).
\end{align}&lt;/script&gt;

&lt;p&gt;If we want to take tension &lt;script type=&quot;math/tex&quot;&gt;\tau&lt;/script&gt; into account, we must also multiply both &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{m}_1&lt;/script&gt; and &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{m}_2&lt;/script&gt; with &lt;script type=&quot;math/tex&quot;&gt;1 - \tau&lt;/script&gt;.&lt;/p&gt;

&lt;p&gt;It is now easy to precalculate coefficients &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{a}&lt;/script&gt;, &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{b}&lt;/script&gt;, &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{c}&lt;/script&gt;, and &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{d}&lt;/script&gt; for each segment and use equation &lt;script type=&quot;math/tex&quot;&gt;\boldsymbol{p}(t) = \boldsymbol{a}t^3 + \boldsymbol{b}t^2 + \boldsymbol{c}t + \boldsymbol{d}&lt;/script&gt; to quickly interpolate that segment.&lt;/p&gt;

&lt;h2 id=&quot;c-implementation&quot;&gt;C++ implementation&lt;/h2&gt;

&lt;p&gt;The code is written in C++. It uses &lt;a href=&quot;https://glm.g-truc.net&quot;&gt;GLM library&lt;/a&gt; that provides the basic linear algebra functionality. Overall, I’ll try to keep the code syntax in this blog quite simple so that it is easy to understand and to convert to other languages.&lt;/p&gt;

&lt;p&gt;In its simplest form, we can define a struct of the spline segment as follows:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c--&quot; data-lang=&quot;c++&quot;&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Segment&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;vec2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;vec2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;vec2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;vec2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;d&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Note that we are using two-dimensional splines here. If you want three-dimensional splines, just replace all occurances of &lt;code class=&quot;highlighter-rouge&quot;&gt;vec2&lt;/code&gt; with &lt;code class=&quot;highlighter-rouge&quot;&gt;vec3&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;As said in the previous chapter, we need parameters &lt;script type=&quot;math/tex&quot;&gt;\alpha&lt;/script&gt; and &lt;script type=&quot;math/tex&quot;&gt;\tau&lt;/script&gt; to calculate the spline. In following code we use variable &lt;code class=&quot;highlighter-rouge&quot;&gt;alpha&lt;/code&gt; for &lt;script type=&quot;math/tex&quot;&gt;\alpha&lt;/script&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;tension&lt;/code&gt; for &lt;script type=&quot;math/tex&quot;&gt;\tau&lt;/script&gt;. A good value for &lt;code class=&quot;highlighter-rouge&quot;&gt;alpha&lt;/code&gt; is 0.5 which gives us a centripetal Catmull-Rom spline, and for &lt;code class=&quot;highlighter-rouge&quot;&gt;tension&lt;/code&gt; a value 0 is a good choice. These values can range from 0 to 1.&lt;/p&gt;

&lt;p&gt;If we now have points &lt;code class=&quot;highlighter-rouge&quot;&gt;p0&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;p1&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;p2&lt;/code&gt;, and &lt;code class=&quot;highlighter-rouge&quot;&gt;p3&lt;/code&gt; for each segment, we can calculate coefficients for segments with equations from previous chapter:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c--&quot; data-lang=&quot;c++&quot;&gt;&lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.0&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pow&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;distance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alpha&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pow&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;distance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alpha&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pow&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;distance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alpha&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;vec2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tension&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;vec2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tension&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;Segment&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;segment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;segment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;2.0&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;segment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;3.0&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;segment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;segment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;We can get the same result slightly more efficiently by simplifying the equations and using the following code to calculate &lt;code class=&quot;highlighter-rouge&quot;&gt;m1&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;m2&lt;/code&gt;:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c--&quot; data-lang=&quot;c++&quot;&gt;&lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t01&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pow&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;distance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alpha&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t12&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pow&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;distance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alpha&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t23&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pow&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;distance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alpha&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;vec2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tension&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t12&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t01&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t01&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)));&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;vec2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tension&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t12&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t23&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t12&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t23&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)));&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;These coefficients can be precaluclated for all spline segments assuming that the parameters do not change afterwards. It is now simple to retrieve a point in a segment &lt;code class=&quot;highlighter-rouge&quot;&gt;segment&lt;/code&gt; by using the precalculated values:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c--&quot; data-lang=&quot;c++&quot;&gt;&lt;span class=&quot;n&quot;&gt;vec2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;point&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;segment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;
             &lt;span class=&quot;n&quot;&gt;segment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;
             &lt;span class=&quot;n&quot;&gt;segment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;
             &lt;span class=&quot;n&quot;&gt;segment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;And &lt;code class=&quot;highlighter-rouge&quot;&gt;t&lt;/code&gt; is of course a value between 0 and 1. With a value 0, the result is the starting point of the spline segment, and with a value 1, the result is the ending point.&lt;/p&gt;

&lt;!--
p:=((t2-t)/(t2-t1))*B1+((t-t1)/(t2-t1))*B2
B1:=((t2-t)/(t2-t0))*A1+((t-t0)/(t2-t0))*A2
B2:=((t3-t)/(t3-t1))*A2+((t-t1)/(t3-t1))*A3
A1:=((t1-t)/(t1-t0))*P0+((t-t0)/(t1-t0))*P1
A2:=((t2-t)/(t2-t1))*P1+((t-t1)/(t2-t1))*P2
A3:=((t3-t)/(t3-t2))*P2+((t-t2)/(t3-t2))*P3

D[p, t] /. {t-&gt;t1} // FullSimplify
D[p, t] /. {t-&gt;t2} // FullSimplify
(t2-t1)D[p, t] /. {t-&gt;t1, t0-&gt;0} // FullSimplify
(t2-t1)D[p, t] /. {t-&gt;t2, t0-&gt;0} // FullSimplify
--&gt;</content><author><name>Mika Rantanen</name></author><summary type="html">Let’s assume that we have a set of points and we want to draw a path that goes through them. The simplest and easiest way to do this is to connect the points with straight lines as shown in Figure 1. A path using straight lines. However, straight lines would cause sharp corners to the path and in many cases a smoother path would be preferred. Figure 2 shows a smoother path that goes through the same points that are in Figure 1. A smooth path. In this post I’m going to focus on Catmull-Rom splines which are commonly used in computer graphics to create smooth curves. For example, the path in Figure 2 uses them. Catmull-Rom splines Catmull-Rom splines are piecewise-defined polynomial functions. A single spline segment is defined by four control points but the actual curve is drawn only between points and as is illustrated in Figure 3. However, it is easy to chain these segments together. One segment of Catmull-Rom spline. If we want to draw a curve that goes through points, we need control points because the curve is not drawn through the first and the last ones. These two additional points can be selected arbitrarily, but they affect the shape of the curve. Now a segment between points and is calculated using points , , , and , where . When these segments are combined together, they form a continuous curve, which passes through all points between and . Figure 2 shows an example of this kind of curve. There are some parameters that can be used to control the shape of the spline. Catmull-Rom splines have three common variants: uniform, centripetal, and chordal. Differences have been studied for example here. Additionally, it is possible to use a tension parameter that defines how “tight” the spline is. When tension is 0, the result looks like the curve in Figure 2, and when tension is 1, the result is straight lines as in Figure 1. The following interactive example demonstrates Catmull-Rom splines and these parameters. You can add points by clicking the canvas and move existing points by dragging them. The control panel allows you to change the tension of the curve and select the spline variant that is drawn. Calculating spline segments Let’s start with following equations that are described in a Wikipedia article about centripetal Catmull-Rom splines: where and where and , , and . The actual segment we are interested in is between and i.e. and . If , the resulting curve is a uniform Catmull-Rom spline. When , the curve is a centripetal variant and when , the result is a chordal variant. Calculating the curve with previous equation can be quite inconvenient. Often it would be better to use precalculated constants , , , and , and represent the curve segment between and as where , , and . Other way to define this is We can get a relationship between the tangents of and by differentiating these with respect to as follows: Now we have where symbols , and are used to represent tangents at the starting point and at the ending point respectively. By solving , , , and from these four equations we get Now we have to determine and and for that we need tangents and . Calculating the derivative of is quite cumbersome, but luckily we can use Mathematica to do the work for us. We get and thus If we want to take tension into account, we must also multiply both and with . It is now easy to precalculate coefficients , , , and for each segment and use equation to quickly interpolate that segment. C++ implementation The code is written in C++. It uses GLM library that provides the basic linear algebra functionality. Overall, I’ll try to keep the code syntax in this blog quite simple so that it is easy to understand and to convert to other languages. In its simplest form, we can define a struct of the spline segment as follows: struct Segment { vec2 a; vec2 b; vec2 c; vec2 d; }; Note that we are using two-dimensional splines here. If you want three-dimensional splines, just replace all occurances of vec2 with vec3. As said in the previous chapter, we need parameters and to calculate the spline. In following code we use variable alpha for and tension for . A good value for alpha is 0.5 which gives us a centripetal Catmull-Rom spline, and for tension a value 0 is a good choice. These values can range from 0 to 1. If we now have points p0, p1, p2, and p3 for each segment, we can calculate coefficients for segments with equations from previous chapter: float t0 = 0.0f; float t1 = t0 + pow(distance(p0, p1), alpha); float t2 = t1 + pow(distance(p1, p2), alpha); float t3 = t2 + pow(distance(p2, p3), alpha); vec2 m1 = (1.0f - tension) * (t2 - t1) * ((p1 - p0) / (t1 - t0) - (p2 - p0) / (t2 - t0) + (p2 - p1) / (t2 - t1)); vec2 m2 = (1.0f - tension) * (t2 - t1) * ((p2 - p1) / (t2 - t1) - (p3 - p1) / (t3 - t1) + (p3 - p2) / (t3 - t2)); Segment segment; segment.a = 2.0f * (p1 - p2) + m1 + m2; segment.b = -3.0f * (p1 - p2) - m1 - m1 - m2; segment.c = m1; segment.d = p1; We can get the same result slightly more efficiently by simplifying the equations and using the following code to calculate m1 and m2: float t01 = pow(distance(p0, p1), alpha); float t12 = pow(distance(p1, p2), alpha); float t23 = pow(distance(p2, p3), alpha); vec2 m1 = (1.0f - tension) * (p2 - p1 + t12 * ((p1 - p0) / t01 - (p2 - p0) / (t01 + t12))); vec2 m2 = (1.0f - tension) * (p2 - p1 + t12 * ((p3 - p2) / t23 - (p3 - p1) / (t12 + t23))); These coefficients can be precaluclated for all spline segments assuming that the parameters do not change afterwards. It is now simple to retrieve a point in a segment segment by using the precalculated values: vec2 point = segment.a * t * t * t + segment.b * t * t + segment.c * t + segment.d; And t is of course a value between 0 and 1. With a value 0, the result is the starting point of the spline segment, and with a value 1, the result is the ending point.</summary></entry></feed>